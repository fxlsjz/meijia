angular.module("ionicLazyLoad",[]);angular.module("ionicLazyLoad").directive("lazyScroll",["$rootScope",function($rootScope){return{restrict:"A",link:function($scope,$element){var origEvent=$scope.$onScroll;$scope.$onScroll=function(){$rootScope.$broadcast("lazyScrollEvent");if(typeof origEvent==="function"){origEvent()}}}}}]).directive("imageLazySrc",["$document","$timeout","$ionicScrollDelegate","$compile",function($document,$timeout,$ionicScrollDelegate,$compile){return{restrict:"A",scope:{lazyScrollResize:"@lazyScrollResize",imageLazyBackgroundImage:"@imageLazyBackgroundImage",imageLazySrc:"@"},link:function($scope,$element,$attributes){if(!$attributes.imageLazyDistanceFromBottomToLoad){$attributes.imageLazyDistanceFromBottomToLoad=0}if(!$attributes.imageLazyDistanceFromRightToLoad){$attributes.imageLazyDistanceFromRightToLoad=0}var loader;if($attributes.imageLazyLoader){loader=$compile('<div class="image-loader-container"><ion-spinner class="image-loader" icon="'+$attributes.imageLazyLoader+'"></ion-spinner></div>')($scope);$element.after(loader)}$scope.$watch("imageLazySrc",function(oldV,newV){if(loader){loader.remove()}if($attributes.imageLazyLoader){loader=$compile('<div class="image-loader-container"><ion-spinner class="image-loader" icon="'+$attributes.imageLazyLoader+'"></ion-spinner></div>')($scope);$element.after(loader)}var deregistration=$scope.$on("lazyScrollEvent",function(){if(isInView()){loadImage();deregistration()}});$timeout(function(){if(isInView()){loadImage();deregistration()}},500)});var deregistration=$scope.$on("lazyScrollEvent",function(){if(isInView()){loadImage();deregistration()}});function loadImage(){$element.bind("load",function(e){if($attributes.imageLazyLoader){loader.remove()}if($scope.lazyScrollResize=="true"){$ionicScrollDelegate.resize()}$element.unbind("load")});if($scope.imageLazyBackgroundImage=="true"){var bgImg=new Image();bgImg.onload=function(){if($attributes.imageLazyLoader){loader.remove()}$element[0].style.backgroundImage="url("+$attributes.imageLazySrc+")";if($scope.lazyScrollResize=="true"){$ionicScrollDelegate.resize()}};bgImg.src=$attributes.imageLazySrc}else{$element[0].src=$attributes.imageLazySrc}}function isInView(){var clientHeight=$document[0].documentElement.clientHeight;var clientWidth=$document[0].documentElement.clientWidth;var imageRect=$element[0].getBoundingClientRect();return(imageRect.top>=0&&imageRect.top<=clientHeight+parseInt($attributes.imageLazyDistanceFromBottomToLoad))&&(imageRect.left>=0&&imageRect.left<=clientWidth+parseInt($attributes.imageLazyDistanceFromRightToLoad))}$element.on("$destroy",function(){deregistration()});$timeout(function(){if(isInView()){loadImage();deregistration()}},500)}}}]);